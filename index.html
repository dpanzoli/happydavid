<!DOCTYPE html> 
 <html lang="fr">
  <head>
   <title>Happy David</title> 
   <meta charset="UTF-8">
   <style type="text/css">
   
	#cvs {
		width: 432px;
		height: 240px;
	}
	
   </style>
   <script src="http://code.jquery.com/jquery-1.8.3.js"></script>
   <script>
   
	$(function() {
	
		navigator.mediaDevices.getUserMedia({ audio: false, video: { width: 400 } }).then(function(mediaStream) {

			var video = document.getElementById('sourcevid');
			video.srcObject = mediaStream;

			var tracks = mediaStream.getTracks();

			//$("#message").html('message: '+tracks[0].label+' connect√©');

			console.log(tracks[0].label)
			console.log(mediaStream)

			video.onloadedmetadata = function(e) {
				video.play();
				snap()
			};
		});
		
		//setInterval(snap, 3000);
		
	});
	
	//Take a screenshot every 3 seconds and get emotion background
	function snap() {
	
		var vivi = document.getElementById('sourcevid');
		var canvas = document.getElementById('cvs')
		var ctx = canvas1.getContext('2d');
		canvas.height=vivi.videoHeight
		canvas.width=vivi.videoWidth
		ctx.drawImage(vivi, 0,0, vivi.videoWidth, vivi.videoHeight);

		canvas.toBlob(function(blob) {
	
			var formImage = new FormData();
			formImage.set('detector', 'agressive');
			formImage.set('attributes', 'all');
			formImage.set('detect_all_feature_points', false);
			formImage.set('force_reprocess_image', true);
			formImage.set('api_key', 'u4a53tef0gh0met9c687in7mk');
			formImage.set('api_secret', '7l90frqqgrqa5pp1qi805s3jpp');
			
			formImage.set('0', blob, 'photo.jpg');
			
			$.ajax({
				type: 'POST',
				url: 'http://api.skybiometry.com/fc/faces/detect.json',
				data: formImage,
				dataType: 'json',
				processData: false,
				contentType: false,
				success: function(data) {
					console.log(data.photos[0].tags[0].attributes.mood);
				},
				error: function(_, e, m) {
					console.log(e);
					console.log(m);
				}
			});
		},
		'image/jpeg');
	}
   </script>
   
  </head>
  <body>
	<div id="photos">
	</div>
	<video id="sourcevid" width='400' autoplay="true"></video>
	<canvas id="cvs"></canvas>
  </body>
 </html>
 